# 开发环境搭建指南

## 系统要求

### 硬件要求
- **CPU**: 4核及以上
- **内存**: 8GB+ (推荐16GB)
- **硬盘**: 50GB+可用空间
- **网络**: 稳定的互联网连接

### 操作系统
- **Windows**: Windows 10/11 64位
- **macOS**: macOS 10.15+（开发iOS需要）
- **Linux**: Ubuntu 18.04+（仅Android）

---

## 环境安装

### 1. Node.js 安装

**Windows & macOS:**
```bash
# 访问官网下载安装包
https://nodejs.org/

# 或使用nvm（推荐）
# Windows: https://github.com/coreybutler/nvm-windows
# macOS/Linux:
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# 安装Node.js 18
nvm install 18
nvm use 18

# 验证安装
node --version  # v18.x.x
npm --version   # 9.x.x
```

### 2. React Native CLI

```bash
npm install -g react-native-cli
```

### 3. Android开发环境

#### 3.1 安装Java JDK

```bash
# 下载并安装JDK 17
# Windows: https://adoptium.net/
# macOS:
brew install openjdk@17

# 配置环境变量（Windows）
JAVA_HOME=C:\Program Files\Eclipse Adoptium\jdk-17.0.x
Path=%JAVA_HOME%\bin

# 验证
java -version
```

#### 3.2 安装Android Studio

1. 下载：https://developer.android.com/studio
2. 安装时勾选：
   - Android SDK
   - Android SDK Platform
   - Android Virtual Device
   - Performance (Intel HAXM)

3. 安装SDK（通过Android Studio SDK Manager）：
   - Android SDK Platform 33
   - Android SDK Build-Tools 33.0.0
   - Android Emulator
   - Android SDK Platform-Tools

#### 3.3 配置环境变量

**Windows:**
```bash
ANDROID_HOME=C:\Users\YOUR_USERNAME\AppData\Local\Android\Sdk

Path=
  %ANDROID_HOME%\platform-tools
  %ANDROID_HOME%\emulator
  %ANDROID_HOME%\tools
  %ANDROID_HOME%\tools\bin
```

**macOS/Linux:**
```bash
# 编辑 ~/.bash_profile 或 ~/.zshrc
export ANDROID_HOME=$HOME/Library/Android/sdk
export PATH=$PATH:$ANDROID_HOME/emulator
export PATH=$PATH:$ANDROID_HOME/platform-tools
export PATH=$PATH:$ANDROID_HOME/tools
export PATH=$PATH:$ANDROID_HOME/tools/bin

# 应用配置
source ~/.zshrc
```

#### 3.4 验证安装

```bash
adb --version
emulator -version
```

### 4. iOS开发环境（仅macOS）

#### 4.1 安装Xcode

```bash
# 从App Store安装Xcode（14.0+）
# 安装Command Line Tools
xcode-select --install

# 验证
xcodebuild -version
```

#### 4.2 安装CocoaPods

```bash
sudo gem install cocoapods

# 或使用Homebrew
brew install cocoapods

# 验证
pod --version
```

### 5. Unity安装（3D功能需要）

1. 下载Unity Hub：https://unity.com/download
2. 通过Unity Hub安装：
   - Unity 2022.3 LTS
   - 模块选择：
     - Android Build Support (含 Android SDK & NDK)
     - iOS Build Support（macOS）

---

## 项目初始化

### 1. 克隆项目（如果从Git）

```bash
cd C:\Users\administer\Desktop
git clone <repository-url> VirtualHumanApp
cd VirtualHumanApp
```

### 2. 创建新项目（从零开始）

```bash
cd C:\Users\administer\Desktop
npx react-native init VirtualHumanApp --template react-native-template-typescript
cd VirtualHumanApp
```

### 3. 安装依赖

```bash
npm install
```

### 4. 依赖包列表

**核心依赖:**
```json
{
  "dependencies": {
    "react": "18.2.0",
    "react-native": "0.73.0",

    "// 导航": "",
    "@react-navigation/native": "^6.1.9",
    "@react-navigation/stack": "^6.3.20",
    "@react-navigation/bottom-tabs": "^6.5.11",
    "react-native-screens": "^3.29.0",
    "react-native-safe-area-context": "^4.8.2",
    "react-native-gesture-handler": "^2.14.1",

    "// 状态管理": "",
    "zustand": "^4.4.7",

    "// 数据库": "",
    "react-native-sqlite-storage": "^6.0.1",

    "// 本地存储": "",
    "@react-native-async-storage/async-storage": "^1.21.0",

    "// 网络请求": "",
    "axios": "^1.6.2",

    "// UI组件": "",
    "react-native-paper": "^5.11.6",
    "react-native-vector-icons": "^10.0.3",
    "react-native-reanimated": "^3.6.1",
    "react-native-svg": "^14.1.0",

    "// 文件系统": "",
    "react-native-fs": "^2.20.0",

    "// 图片": "",
    "react-native-fast-image": "^8.6.3",
    "react-native-image-picker": "^7.1.0",

    "// 权限": "",
    "react-native-permissions": "^4.0.3",

    "// Unity集成": "",
    "@azesmway/react-native-unity": "^0.2.0",

    "// 语音（稍后配置）": "",
    "@azure/cognitiveservices-speech-sdk": "^1.34.0",

    "// 工具": "",
    "uuid": "^9.0.1",
    "date-fns": "^3.0.6",
    "lodash": "^4.17.21"
  },
  "devDependencies": {
    "@types/react": "^18.2.45",
    "@types/react-native": "^0.73.0",
    "@types/uuid": "^9.0.7",
    "@types/lodash": "^4.14.202",

    "typescript": "^5.3.3",

    "// 测试": "",
    "@testing-library/react-native": "^12.4.2",
    "jest": "^29.7.0",

    "// 代码质量": "",
    "eslint": "^8.56.0",
    "prettier": "^3.1.1",
    "@typescript-eslint/eslint-plugin": "^6.15.0",
    "@typescript-eslint/parser": "^6.15.0"
  }
}
```

**安装所有依赖:**
```bash
npm install --save \
  @react-navigation/native \
  @react-navigation/stack \
  @react-navigation/bottom-tabs \
  react-native-screens \
  react-native-safe-area-context \
  react-native-gesture-handler \
  zustand \
  react-native-sqlite-storage \
  @react-native-async-storage/async-storage \
  axios \
  react-native-paper \
  react-native-vector-icons \
  react-native-reanimated \
  react-native-svg \
  react-native-fs \
  react-native-fast-image \
  react-native-image-picker \
  react-native-permissions \
  uuid \
  date-fns \
  lodash

npm install --save-dev \
  @types/uuid \
  @types/lodash
```

### 5. iOS依赖安装（macOS）

```bash
cd ios
pod install
cd ..
```

---

## 配置API密钥

### 1. 创建环境变量文件

```bash
# 在项目根目录创建 .env 文件
cp .env.example .env
```

**.env 文件内容:**
```bash
# OpenAI API
OPENAI_API_KEY=sk-your-openai-api-key
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4-turbo

# Azure Speech Services
AZURE_SPEECH_KEY=your-azure-speech-key
AZURE_SPEECH_REGION=eastus

# 其他配置
API_TIMEOUT=30000
MAX_TOKENS=500
```

### 2. 安装环境变量支持

```bash
npm install react-native-dotenv
npm install --save-dev @types/react-native-dotenv
```

### 3. 配置babel.config.js

```javascript
module.exports = {
  presets: ['module:metro-react-native-babel-preset'],
  plugins: [
    ['module:react-native-dotenv', {
      moduleName: '@env',
      path: '.env',
    }],
    'react-native-reanimated/plugin',
  ],
};
```

### 4. 配置TypeScript类型

创建 `src/types/env.d.ts`:
```typescript
declare module '@env' {
  export const OPENAI_API_KEY: string;
  export const OPENAI_BASE_URL: string;
  export const OPENAI_MODEL: string;
  export const AZURE_SPEECH_KEY: string;
  export const AZURE_SPEECH_REGION: string;
  export const API_TIMEOUT: string;
  export const MAX_TOKENS: string;
}
```

---

## 申请API密钥

### 1. OpenAI API

**步骤:**
1. 访问：https://platform.openai.com/signup
2. 注册/登录账号
3. 进入 API Keys页面
4. 点击 "Create new secret key"
5. 复制密钥（只显示一次！）
6. 设置使用限额（防止超支）

**定价（参考）:**
- GPT-4 Turbo: $10/1M input tokens, $30/1M output tokens
- 预计成本：每千次对话约 $5-20（取决于对话长度）

**环境变量:**
```bash
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxx
```

### 2. Anthropic Claude（备选）

**步骤:**
1. 访问：https://console.anthropic.com/
2. 注册账号
3. 获取API Key
4. 查看文档：https://docs.anthropic.com/

**定价（参考）:**
- Claude 3 Sonnet: $3/1M input tokens, $15/1M output tokens

### 3. Azure Speech Services

**步骤:**
1. 访问：https://portal.azure.com/
2. 创建资源 → AI + 机器学习 → 语音服务
3. 选择定价层：
   - F0（免费）: 5小时语音转文字/月
   - S0（标准）: 按使用量付费
4. 创建后获取密钥和区域

**环境变量:**
```bash
AZURE_SPEECH_KEY=your-32-character-key
AZURE_SPEECH_REGION=eastus  # 或其他区域
```

**定价（参考）:**
- STT: $1/小时
- TTS: $16/1M字符

### 4. Firebase（可选，用于云端同步）

**步骤:**
1. 访问：https://console.firebase.google.com/
2. 创建项目
3. 添加Android/iOS应用
4. 下载配置文件：
   - Android: `google-services.json`
   - iOS: `GoogleService-Info.plist`
5. 启用服务：
   - Authentication
   - Firestore Database
   - Storage

---

## 运行项目

### 1. 启动Metro Bundler

```bash
npm start
```

### 2. 运行Android

```bash
# 启动模拟器（如果未启动）
emulator -avd Pixel_5_API_33

# 运行应用
npm run android
# 或
npx react-native run-android
```

### 3. 运行iOS（macOS）

```bash
npm run ios
# 或
npx react-native run-ios
```

### 4. 常见问题排查

**问题1: Metro Bundler端口占用**
```bash
# Windows
netstat -ano | findstr :8081
taskkill /PID <PID> /F

# macOS/Linux
lsof -ti:8081 | xargs kill -9
```

**问题2: Android构建失败**
```bash
# 清理缓存
cd android
./gradlew clean

# 或完全重置
cd ..
rm -rf android/app/build
npm start -- --reset-cache
```

**问题3: iOS构建失败**
```bash
cd ios
pod deintegrate
pod install
cd ..
```

**问题4: 依赖冲突**
```bash
# 删除node_modules和lockfile重新安装
rm -rf node_modules package-lock.json
npm install
```

---

## 开发工具推荐

### 1. IDE/编辑器
- **VS Code**（推荐）
  - 插件：
    - React Native Tools
    - ES7+ React/Redux/React-Native snippets
    - Prettier
    - ESLint
    - GitLens

### 2. 调试工具
- **React Native Debugger**: https://github.com/jhen0409/react-native-debugger
- **Flipper**: https://fbflipper.com/

### 3. API测试
- **Postman**: https://www.postman.com/
- **Insomnia**: https://insomnia.rest/

### 4. 数据库查看
- **DB Browser for SQLite**: https://sqlitebrowser.org/

---

## Git配置

### .gitignore

```bash
# React Native
node_modules/
npm-debug.log
yarn-error.log

# Android
android/app/build/
android/.gradle/
*.apk

# iOS
ios/Pods/
ios/build/
*.ipa

# 环境变量
.env
.env.local
.env.production

# IDE
.vscode/
.idea/

# OS
.DS_Store
Thumbs.db

# 临时文件
*.log
*.tmp
```

### Git Hooks（可选）

```bash
# 安装husky
npm install --save-dev husky

# 初始化
npx husky install

# 添加pre-commit hook
npx husky add .husky/pre-commit "npm run lint"
```

---

## 团队协作

### 1. 代码规范

**ESLint配置** (.eslintrc.js):
```javascript
module.exports = {
  root: true,
  extends: '@react-native',
  rules: {
    'no-console': 'warn',
    'prefer-const': 'error',
    '@typescript-eslint/no-unused-vars': 'warn',
  },
};
```

**Prettier配置** (.prettierrc):
```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "printWidth": 100
}
```

### 2. 分支策略

```bash
main          # 生产环境
├─ develop    # 开发环境
   ├─ feature/xxx
   ├─ bugfix/xxx
   └─ hotfix/xxx
```

### 3. 提交规范

```bash
# 格式
<type>(<scope>): <subject>

# 示例
feat(chat): 添加语音聊天功能
fix(database): 修复记忆查询bug
docs(readme): 更新安装说明
```

---

## 性能监控

### 1. 集成Sentry

```bash
npm install @sentry/react-native

npx @sentry/wizard -i reactNative -p android ios
```

### 2. 配置Sentry

```typescript
import * as Sentry from '@sentry/react-native';

Sentry.init({
  dsn: 'your-sentry-dsn',
  tracesSampleRate: 1.0,
});
```

---

## 下一步

- ✅ 环境搭建完成
- ✅ API密钥配置完成
- ✅ 项目运行成功
- → 开始Phase 1开发

---

**文档版本**: v1.0
**最后更新**: 2026-02-04
